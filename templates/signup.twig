<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - TicketApp</title>
  <link rel="stylesheet" href="/css/login.css">
</head>
<body>

<main class="login-page">

  <!-- Animated Blobs -->
  <div class="blob blob--blue" aria-hidden="true"></div>
  <div class="blob blob--purple" aria-hidden="true"></div>

  <!-- Sign Up Form Card -->
  <section aria-label="Sign Up Form">
    <form id="signup-form" class="login-form-card">
      <h1>Sign Up</h1>

      <p class="login-error" id="signup-error" style="display:none;"></p>

      <input type="email" id="signup-email" placeholder="Email" class="login-input" required>
      <input type="password" id="signup-password" placeholder="Password" class="login-input" required>
      <input type="password" id="signup-confirm" placeholder="Confirm Password" class="login-input" required>

      <button type="submit" class="login-btn">Sign Up</button>

      <p class="login-helper">
        Already have an account? 
        <a href="/auth/login">Login</a>
      </p>
    </form>
  </section>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Footer -->
  {% include 'footer.twig' %}

</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("signup-form");
  const errorEl = document.getElementById("signup-error");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const email = document.getElementById("signup-email").value.trim();
    const password = document.getElementById("signup-password").value;
    const confirm = document.getElementById("signup-confirm").value;

    if(!email || !password || !confirm){
      showToast("All fields are required.", "error");
      return;
    }

    if(password !== confirm){
      showToast("Passwords do not match.", "error");
      return;
    }

    if(password.length < 6){
      showToast("Password must be at least 6 characters.", "error");
      return;
    }

    let users = JSON.parse(localStorage.getItem("ticketapp_users") || "[]");
    if(users.find(u => u.email === email)){
      showToast("User already exists.", "error");
      return;
    }

    users.push({ email, password });
    localStorage.setItem("ticketapp_users", JSON.stringify(users));

    showToast("Account created successfully! Redirecting to login...", "success");
    setTimeout(() => window.location.href = "/auth/login?toast=Account created&type=success", 1500);
  });

  // Toast function (same as Login)
  function showToast(message, type = "success") {
    const container = document.getElementById("toast-container");
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.className = `toast ${type}`;
    container.appendChild(toast);

    toast.style.transform = "translateY(-100px)";
    toast.style.opacity = "0";
    toast.style.transition = "all 0.4s ease-in-out";
    requestAnimationFrame(() => {
      toast.style.transform = "translateY(30px)";
      toast.style.opacity = "1";
    });

    setTimeout(() => {
      toast.style.transform = "translateY(-100px)";
      toast.style.opacity = "0";
      toast.addEventListener('transitionend', () => toast.remove());
    }, 2500);
  }
});
</script>

</body>
</html>
